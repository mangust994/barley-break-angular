import { Component, ContentChild, Input, Output, EventEmitter, Optional, Host } from '@angular/core';
import { first } from 'rxjs/operators';
import { BaseToolbarDirective } from './grid-toolbar.base';
import { IgxGridToolbarComponent } from './grid-toolbar.component';
import { IgxExcelTextDirective, IgxCSVTextDirective } from './common';
import { CsvFileTypes, IgxCsvExporterOptions, IgxCsvExporterService, IgxExcelExporterOptions, IgxExcelExporterService } from '../../services/public_api';
/**
 * Provides a pre-configured exporter component for the grid.
 *
 * @remarks
 * This component still needs the actual exporter service(s) provided in the DI chain
 * in order to export something.
 *
 * @igxModule IgxGridToolbarModule
 * @igxParent IgxGridToolbarComponent
 *
 */
export class IgxGridToolbarExporterComponent extends BaseToolbarDirective {
    constructor(toolbar, excelExporter, csvExporter) {
        super(toolbar);
        this.toolbar = toolbar;
        this.excelExporter = excelExporter;
        this.csvExporter = csvExporter;
        /**
         * Show entry for CSV export.
         */
        this.exportCSV = true;
        /**
         * Show entry for Excel export.
         */
        this.exportExcel = true;
        /**
         * The name for the exported file.
         */
        this.filename = 'ExportedData';
        /**
         * Emitted when starting an export operation. Re-emitted additionally
         * by the grid itself.
         */
        this.exportStarted = new EventEmitter();
        /**
         * Emitted on successful ending of an export operation.
         */
        this.exportEnded = new EventEmitter();
        /**
         * Indicates whether there is an export in progress.
         */
        this.isExporting = false;
    }
    /**
     * Returns whether the CSV exporter service is available in the DI chain.
     */
    get hasCsvExporter() {
        return !!this.csvExporter;
    }
    /**
     * Returns whether the Excel exporter service is available in the DI chain.
     */
    get hasExcelExporter() {
        return !!this.excelExporter;
    }
    export(type, toggleRef) {
        let options;
        let exporter;
        toggleRef === null || toggleRef === void 0 ? void 0 : toggleRef.close();
        switch (type) {
            case 'csv':
                options = new IgxCsvExporterOptions(this.filename, CsvFileTypes.CSV);
                exporter = this.csvExporter;
                break;
            case 'excel':
                options = new IgxExcelExporterOptions(this.filename);
                exporter = this.excelExporter;
        }
        const args = { exporter, options, grid: this.grid, cancel: false };
        this.exportStarted.emit(args);
        this.grid.onToolbarExporting.emit(args);
        this.isExporting = true;
        this.toolbar.showProgress = true;
        if (args.cancel) {
            return;
        }
        exporter.exportEnded.pipe(first()).subscribe(() => {
            this.exportEnded.emit();
            this.isExporting = false;
            this.toolbar.showProgress = false;
        });
        exporter.export(this.grid, options);
    }
}
IgxGridToolbarExporterComponent.decorators = [
    { type: Component, args: [{
                selector: 'igx-grid-toolbar-exporter',
                template: "<div class=\"igx-grid-toolbar__dropdown\" id=\"btnExport\">\n    <button [title]=\"grid?.resourceStrings.igx_grid_toolbar_exporter_button_tooltip\" [disabled]=\"isExporting\"\n        igxButton=\"outlined\" [displayDensity]=\"grid.displayDensity\" igxRipple #btn (click)=\"toggle(btn, toggleRef)\">\n        <igx-icon>import_export</igx-icon>\n        <span #ref>\n            <ng-content></ng-content>\n        </span>\n        <span *ngIf=\"!ref.childNodes.length\">\n            {{ grid.exportText || grid?.resourceStrings.igx_grid_toolbar_exporter_button_label }}\n        </span>\n        <igx-icon>arrow_drop_down</igx-icon>\n    </button>\n\n    <ul class=\"igx-grid-toolbar__dd-list\" igxToggle #toggleRef=\"toggle\">\n        <li *ngIf=\"grid.exportExcel || exportExcel\" #btnExportExcel id=\"btnExportExcel\"\n            class=\"igx-grid-toolbar__dd-list-items\" igxRipple (click)=\"export('excel', toggleRef)\">\n            <ng-template #excel>\n                <ng-content select=[excelText],excel-text></ng-content>\n            </ng-template>\n            <excel-text *ngIf=\"!hasExcelAttr\">\n                {{ grid.exportExcelText || grid?.resourceStrings.igx_grid_toolbar_exporter_excel_entry_text}}\n            </excel-text>\n            <ng-container *ngTemplateOutlet=\"excel\"></ng-container>\n        </li>\n\n        <li *ngIf=\"grid.exportCsv || exportCSV\" #btnExportCsv id=\"btnExportCsv\" class=\"igx-grid-toolbar__dd-list-items\"\n            igxRipple (click)=\"export('csv', toggleRef)\">\n            <ng-template #csv>\n                <ng-content select=[csvText],csv-text></ng-content>\n            </ng-template>\n            <csv-text *ngIf=\"!hasCSVAttr\">\n                {{ grid.exportCsvText || grid?.resourceStrings.igx_grid_toolbar_exporter_csv_entry_text }}</csv-text>\n            <ng-container *ngTemplateOutlet=\"csv\"></ng-container>\n        </li>\n    </ul>\n</div>\n"
            },] }
];
IgxGridToolbarExporterComponent.ctorParameters = () => [
    { type: IgxGridToolbarComponent, decorators: [{ type: Host }] },
    { type: IgxExcelExporterService, decorators: [{ type: Optional }] },
    { type: IgxCsvExporterService, decorators: [{ type: Optional }] }
];
IgxGridToolbarExporterComponent.propDecorators = {
    hasExcelAttr: [{ type: ContentChild, args: [IgxExcelTextDirective,] }],
    hasCSVAttr: [{ type: ContentChild, args: [IgxCSVTextDirective,] }],
    exportCSV: [{ type: Input }],
    exportExcel: [{ type: Input }],
    filename: [{ type: Input }],
    exportStarted: [{ type: Output }],
    exportEnded: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC10b29sYmFyLWV4cG9ydGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lnbml0ZXVpLWFuZ3VsYXIvc3JjL2xpYi9ncmlkcy90b29sYmFyL2dyaWQtdG9vbGJhci1leHBvcnRlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDM0QsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDbkUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLG1CQUFtQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ3RFLE9BQU8sRUFDSCxZQUFZLEVBRVoscUJBQXFCLEVBQ3JCLHFCQUFxQixFQUNyQix1QkFBdUIsRUFDdkIsdUJBQXVCLEVBQzFCLE1BQU0sMkJBQTJCLENBQUM7QUFlbkM7Ozs7Ozs7Ozs7R0FVRztBQUtILE1BQU0sT0FBTywrQkFBZ0MsU0FBUSxvQkFBb0I7SUFrRXJFLFlBQ3NCLE9BQWdDLEVBQzlCLGFBQXNDLEVBQ3RDLFdBQWtDO1FBRXRELEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUpHLFlBQU8sR0FBUCxPQUFPLENBQXlCO1FBQzlCLGtCQUFhLEdBQWIsYUFBYSxDQUF5QjtRQUN0QyxnQkFBVyxHQUFYLFdBQVcsQ0FBdUI7UUF2QzFEOztXQUVHO1FBRUksY0FBUyxHQUFHLElBQUksQ0FBQztRQUV4Qjs7V0FFRztRQUVJLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBRTFCOztXQUVHO1FBRUksYUFBUSxHQUFHLGNBQWMsQ0FBQztRQUVqQzs7O1dBR0c7UUFFSSxrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFvQixDQUFDO1FBRTVEOztXQUVHO1FBRUksZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBRTlDOztXQUVHO1FBQ0ksZ0JBQVcsR0FBRyxLQUFLLENBQUM7SUFRM0IsQ0FBQztJQXhERDs7T0FFRztJQUNILElBQVcsY0FBYztRQUNyQixPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzlCLENBQUM7SUFFRDs7T0FFRztJQUNILElBQVcsZ0JBQWdCO1FBQ3ZCLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUM7SUFDaEMsQ0FBQztJQThDTSxNQUFNLENBQUMsSUFBcUIsRUFBRSxTQUE4QjtRQUMvRCxJQUFJLE9BQTJCLENBQUM7UUFDaEMsSUFBSSxRQUF5QixDQUFDO1FBRTlCLFNBQVMsYUFBVCxTQUFTLHVCQUFULFNBQVMsQ0FBRSxLQUFLLEdBQUc7UUFFbkIsUUFBUSxJQUFJLEVBQUU7WUFDVixLQUFLLEtBQUs7Z0JBQ04sT0FBTyxHQUFHLElBQUkscUJBQXFCLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3JFLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO2dCQUM1QixNQUFNO1lBQ1YsS0FBSyxPQUFPO2dCQUNSLE9BQU8sR0FBRyxJQUFJLHVCQUF1QixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDckQsUUFBUSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUM7U0FDckM7UUFFRCxNQUFNLElBQUksR0FBRyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBc0IsQ0FBQztRQUV2RixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QixJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4QyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztRQUN4QixJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7UUFFakMsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2IsT0FBTztTQUNWO1FBRUQsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO1lBQzlDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDeEIsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7WUFDekIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxDQUFDO1FBRUgsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3hDLENBQUM7OztZQWhISixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLDJCQUEyQjtnQkFDckMsNjREQUFxRDthQUN4RDs7O1lBdENRLHVCQUF1Qix1QkEwR3ZCLElBQUk7WUFsR1QsdUJBQXVCLHVCQW1HbEIsUUFBUTtZQXJHYixxQkFBcUIsdUJBc0doQixRQUFROzs7MkJBL0RaLFlBQVksU0FBQyxxQkFBcUI7eUJBT2xDLFlBQVksU0FBQyxtQkFBbUI7d0JBb0JoQyxLQUFLOzBCQU1MLEtBQUs7dUJBTUwsS0FBSzs0QkFPTCxNQUFNOzBCQU1OLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIENvbnRlbnRDaGlsZCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBPcHRpb25hbCwgSG9zdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgZmlyc3QgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBCYXNlVG9vbGJhckRpcmVjdGl2ZSB9IGZyb20gJy4vZ3JpZC10b29sYmFyLmJhc2UnO1xuaW1wb3J0IHsgSWd4R3JpZFRvb2xiYXJDb21wb25lbnQgfSBmcm9tICcuL2dyaWQtdG9vbGJhci5jb21wb25lbnQnO1xuaW1wb3J0IHsgSWd4RXhjZWxUZXh0RGlyZWN0aXZlLCBJZ3hDU1ZUZXh0RGlyZWN0aXZlIH0gZnJvbSAnLi9jb21tb24nO1xuaW1wb3J0IHtcbiAgICBDc3ZGaWxlVHlwZXMsXG4gICAgSWd4QmFzZUV4cG9ydGVyLFxuICAgIElneENzdkV4cG9ydGVyT3B0aW9ucyxcbiAgICBJZ3hDc3ZFeHBvcnRlclNlcnZpY2UsXG4gICAgSWd4RXhjZWxFeHBvcnRlck9wdGlvbnMsXG4gICAgSWd4RXhjZWxFeHBvcnRlclNlcnZpY2Vcbn0gZnJvbSAnLi4vLi4vc2VydmljZXMvcHVibGljX2FwaSc7XG5pbXBvcnQgeyBJZ3hHcmlkQmFzZURpcmVjdGl2ZSB9IGZyb20gJy4uL2dyaWQtYmFzZS5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgSWd4VG9nZ2xlRGlyZWN0aXZlIH0gZnJvbSAnLi4vLi4vZGlyZWN0aXZlcy90b2dnbGUvdG9nZ2xlLmRpcmVjdGl2ZSc7XG5cblxuZXhwb3J0IHR5cGUgSWd4RXhwb3J0ZXJPcHRpb25zID0gSWd4Q3N2RXhwb3J0ZXJPcHRpb25zIHwgSWd4RXhjZWxFeHBvcnRlck9wdGlvbnM7XG5cblxuZXhwb3J0IGludGVyZmFjZSBJZ3hFeHBvcnRlckV2ZW50IHtcbiAgICBleHBvcnRlcjogSWd4QmFzZUV4cG9ydGVyO1xuICAgIG9wdGlvbnM6IElneEV4cG9ydGVyT3B0aW9ucztcbiAgICBncmlkOiBJZ3hHcmlkQmFzZURpcmVjdGl2ZTtcbiAgICBjYW5jZWw6IGJvb2xlYW47XG59XG5cbi8qKlxuICogUHJvdmlkZXMgYSBwcmUtY29uZmlndXJlZCBleHBvcnRlciBjb21wb25lbnQgZm9yIHRoZSBncmlkLlxuICpcbiAqIEByZW1hcmtzXG4gKiBUaGlzIGNvbXBvbmVudCBzdGlsbCBuZWVkcyB0aGUgYWN0dWFsIGV4cG9ydGVyIHNlcnZpY2UocykgcHJvdmlkZWQgaW4gdGhlIERJIGNoYWluXG4gKiBpbiBvcmRlciB0byBleHBvcnQgc29tZXRoaW5nLlxuICpcbiAqIEBpZ3hNb2R1bGUgSWd4R3JpZFRvb2xiYXJNb2R1bGVcbiAqIEBpZ3hQYXJlbnQgSWd4R3JpZFRvb2xiYXJDb21wb25lbnRcbiAqXG4gKi9cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnaWd4LWdyaWQtdG9vbGJhci1leHBvcnRlcicsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2dyaWQtdG9vbGJhci1leHBvcnRlci5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgSWd4R3JpZFRvb2xiYXJFeHBvcnRlckNvbXBvbmVudCBleHRlbmRzIEJhc2VUb29sYmFyRGlyZWN0aXZlIHtcblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBAQ29udGVudENoaWxkKElneEV4Y2VsVGV4dERpcmVjdGl2ZSlcbiAgICBwdWJsaWMgaGFzRXhjZWxBdHRyOiBJZ3hFeGNlbFRleHREaXJlY3RpdmU7XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgQENvbnRlbnRDaGlsZChJZ3hDU1ZUZXh0RGlyZWN0aXZlKVxuICAgIHB1YmxpYyBoYXNDU1ZBdHRyOiBJZ3hDU1ZUZXh0RGlyZWN0aXZlO1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBDU1YgZXhwb3J0ZXIgc2VydmljZSBpcyBhdmFpbGFibGUgaW4gdGhlIERJIGNoYWluLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgaGFzQ3N2RXhwb3J0ZXIoKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuY3N2RXhwb3J0ZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBFeGNlbCBleHBvcnRlciBzZXJ2aWNlIGlzIGF2YWlsYWJsZSBpbiB0aGUgREkgY2hhaW4uXG4gICAgICovXG4gICAgcHVibGljIGdldCBoYXNFeGNlbEV4cG9ydGVyKCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLmV4Y2VsRXhwb3J0ZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2hvdyBlbnRyeSBmb3IgQ1NWIGV4cG9ydC5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBleHBvcnRDU1YgPSB0cnVlO1xuXG4gICAgLyoqXG4gICAgICogU2hvdyBlbnRyeSBmb3IgRXhjZWwgZXhwb3J0LlxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGV4cG9ydEV4Y2VsID0gdHJ1ZTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBuYW1lIGZvciB0aGUgZXhwb3J0ZWQgZmlsZS5cbiAgICAgKi9cbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBmaWxlbmFtZSA9ICdFeHBvcnRlZERhdGEnO1xuXG4gICAgLyoqXG4gICAgICogRW1pdHRlZCB3aGVuIHN0YXJ0aW5nIGFuIGV4cG9ydCBvcGVyYXRpb24uIFJlLWVtaXR0ZWQgYWRkaXRpb25hbGx5XG4gICAgICogYnkgdGhlIGdyaWQgaXRzZWxmLlxuICAgICAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHB1YmxpYyBleHBvcnRTdGFydGVkID0gbmV3IEV2ZW50RW1pdHRlcjxJZ3hFeHBvcnRlckV2ZW50PigpO1xuXG4gICAgLyoqXG4gICAgICogRW1pdHRlZCBvbiBzdWNjZXNzZnVsIGVuZGluZyBvZiBhbiBleHBvcnQgb3BlcmF0aW9uLlxuICAgICAqL1xuICAgIEBPdXRwdXQoKVxuICAgIHB1YmxpYyBleHBvcnRFbmRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICAgIC8qKlxuICAgICAqIEluZGljYXRlcyB3aGV0aGVyIHRoZXJlIGlzIGFuIGV4cG9ydCBpbiBwcm9ncmVzcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgaXNFeHBvcnRpbmcgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBASG9zdCgpIHByb3RlY3RlZCB0b29sYmFyOiBJZ3hHcmlkVG9vbGJhckNvbXBvbmVudCxcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBleGNlbEV4cG9ydGVyOiBJZ3hFeGNlbEV4cG9ydGVyU2VydmljZSxcbiAgICAgICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBjc3ZFeHBvcnRlcjogSWd4Q3N2RXhwb3J0ZXJTZXJ2aWNlLFxuICAgICkge1xuICAgICAgICBzdXBlcih0b29sYmFyKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZXhwb3J0KHR5cGU6ICdleGNlbCcgfCAnY3N2JywgdG9nZ2xlUmVmPzogSWd4VG9nZ2xlRGlyZWN0aXZlKTogdm9pZCB7XG4gICAgICAgIGxldCBvcHRpb25zOiBJZ3hFeHBvcnRlck9wdGlvbnM7XG4gICAgICAgIGxldCBleHBvcnRlcjogSWd4QmFzZUV4cG9ydGVyO1xuXG4gICAgICAgIHRvZ2dsZVJlZj8uY2xvc2UoKTtcblxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2Nzdic6XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IG5ldyBJZ3hDc3ZFeHBvcnRlck9wdGlvbnModGhpcy5maWxlbmFtZSwgQ3N2RmlsZVR5cGVzLkNTVik7XG4gICAgICAgICAgICAgICAgZXhwb3J0ZXIgPSB0aGlzLmNzdkV4cG9ydGVyO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZXhjZWwnOlxuICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBuZXcgSWd4RXhjZWxFeHBvcnRlck9wdGlvbnModGhpcy5maWxlbmFtZSk7XG4gICAgICAgICAgICAgICAgZXhwb3J0ZXIgPSB0aGlzLmV4Y2VsRXhwb3J0ZXI7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhcmdzID0geyBleHBvcnRlciwgb3B0aW9ucywgZ3JpZDogdGhpcy5ncmlkLCBjYW5jZWw6IGZhbHNlIH0gYXMgSWd4RXhwb3J0ZXJFdmVudDtcblxuICAgICAgICB0aGlzLmV4cG9ydFN0YXJ0ZWQuZW1pdChhcmdzKTtcbiAgICAgICAgdGhpcy5ncmlkLm9uVG9vbGJhckV4cG9ydGluZy5lbWl0KGFyZ3MpO1xuICAgICAgICB0aGlzLmlzRXhwb3J0aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy50b29sYmFyLnNob3dQcm9ncmVzcyA9IHRydWU7XG5cbiAgICAgICAgaWYgKGFyZ3MuY2FuY2VsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBleHBvcnRlci5leHBvcnRFbmRlZC5waXBlKGZpcnN0KCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmV4cG9ydEVuZGVkLmVtaXQoKTtcbiAgICAgICAgICAgIHRoaXMuaXNFeHBvcnRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMudG9vbGJhci5zaG93UHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZXhwb3J0ZXIuZXhwb3J0KHRoaXMuZ3JpZCwgb3B0aW9ucyk7XG4gICAgfVxufVxuIl19